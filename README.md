# Hannibal

一种简单的方法来使用android SharePreference。

## 在项目中使用[Hannibai](https://github.com/xuehuayous/Hannibal) 

1. 如果您的项目使用 Gradle 构建, 只需要在您的build.gradle文件添加如下到 `dependencies` :

	```
	compile 'com.kevin:hannibai:0.2.7'
	annotationProcessor 'com.kevin:hannibai-compiler:0.2.5'
	```

2. 引入JSON序列化

	```
	compile 'com.kevin:hannibai-converter-gson:0.2.6'
	```

## 简单使用


1. 在Application 中初始化

	```
	Hannibai.init(this);
	if (debug) {
	    Hannibai.setDebug(true);
	}
	Hannibai.setConverterFactory(GsonConverterFactory.create());
	```

2. 创建一个类，使用`SharePreference`进行注解。

	```
	@SharePreference
	public class TestPreference {
	}
	```

3. 加入一个成员变量

	```
	@SharePreference
	public class TestPreference {
	    public String name;
	}
	```

4. ReBuild项目，自动生成如下接口和实现类

	```
	/**
	 * Generated by Hannibai. Do not edit it!
	 */
	public interface TestPreferenceHandle extends IHandle {
	
	  @DefString("")
	  String getName();
	
	  @Apply
	  void setName(final String name);
	
	  @Apply
	  void removeName();
	}
	```

	```
	/**
	 * Generated by Hannibai. Do not edit it!
	 */
	final class TestPreferenceHandleImpl implements TestPreferenceHandle, IHandle {
	
	  // ... ...
	  
	  @DefString("")
	  public String getName() {
	    return Hannibai.get1(mSharedPreferencesName, mId, "name", "");
	  }
	
	  @Apply
	  public void setName(final String name) {
	    Hannibai.set1(mSharedPreferencesName, mId, "name", -1L, false, name);
	  }
	
	  @Apply
	  public void removeName() {
	    Hannibai.remove1(mSharedPreferencesName, mId, "name");
	  }
	  
	  // ... ...
	}
	```

5. 在代码中使用

	```
	TestPreferenceHandle testPreference = Hannibai.create(TestPreferenceHandle.class);
	// 设置name到SharePreference
	testPreference.setName("Kevin zhou");
	// 在SharePreference中获取name
	String name = testPreference.getName();
	// 在SharePreference中移除name
	testPreference.removeName();
	```

## 进阶使用

1. 设置默认值

	```
	@DefString("zwenkai")
	public String userName;
	```

	支持

	| 类型 | sample |
	|---|---|
	| DefString | @DefString("zwenkai")|
	| DefInt | @DefInt(18)|
	| DefBoolean | @DefBoolean(true)|
	| DefLong | @DefLong(123456789)|
	| DefFloat | @DefFloat(123.45F)|

2. 设置过期时间

	> 默认不会过期
	
	```
	@Expire(value = 3, unit = Expire.Unit.MINUTES)
	public long salary;
	```
	
	可以设置更新数据时重新倒计时：
	
	```
	@Expire(value = 5, unit = Expire.Unit.MINUTES, update = true)
	public long salary;
	```
	
	支持
	
	| 单位 | sample |
	|---|---|
	| 毫秒 | @Expire(value = 1, unit = Expire.Unit.MILLISECONDS)|
	| 秒 | @Expire(value = 1, unit = Expire.Unit.SECONDS)|
	| 分 | @Expire(value = 1, unit = Expire.Unit.MINUTES)|
	| 小时 | @Expire(value = 1, unit = Expire.Unit.HOURS)|
	| 天 | @Expire(value = 1, unit = Expire.Unit.DAYS)|
	
3. 设置提交类型

	> 提交类型有`Commit`和`Apply`两种，默认为`Apply`。
	
	1. Commit
	
		```
		@Commit
		public String userName;
		```

	2. Apply
	
		```
		@Apply
		public String userName;
		```
	
# 混淆

> 如果使用了混淆，添加如下到混淆配置文件

```
-dontwarn com.kevin.hannibai.**
-keep class com.kevin.hannibai.** { *; }
-keep class * implements com.kevin.hannibai.IHandle { *; }
-keep @com.kevin.hannibai.annotation.SharePreference class * { *; }
```